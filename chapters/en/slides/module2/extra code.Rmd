
```{python}
import pandas as pd
import numpy as np
import altair as alt
from altair_saver import save
import glob
from sklearn.pipeline import Pipeline, make_pipeline
import matplotlib.pyplot as plt
from sklearn.tree import DecisionTreeClassifier, DecisionTreeRegressor, export_graphviz

from IPython.display import HTML, display
from PIL import Image, ImageFile

from plot_classifier import plot_classifier
from sklearn.compose import make_column_transformer, ColumnTransformer

# Classifiers and regressors
from sklearn.dummy import DummyClassifier, DummyRegressor

# Preprocessing and pipeline
from sklearn.impute import SimpleImputer
from sklearn.metrics.pairwise import euclidean_distances

# train test split and cross validation
from sklearn.model_selection import cross_val_score, cross_validate, train_test_split
from sklearn.neighbors import KNeighborsClassifier, KNeighborsRegressor
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import OneHotEncoder, OrdinalEncoder, StandardScaler, MinMaxScaler
from sklearn.svm import SVC
from sklearn.tree import DecisionTreeClassifier

```



```{python}
pk = pd.read_csv('data/pokemon.csv')

## Adjusted path 
path = "../../../../static/module3/"
pk['legendary'] =  np.where(pk['legendary'] == 1, "Lengend", "Reg")
pk

X= pk.drop(columns = ['deck_no', 'name', 'type', 'legendary', 'total_bs'])
y = pk['legendary']

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=5335)
model = DecisionTreeClassifier(max_depth=4)
model.fit(X_train,y_train)
```

```{python}

display_tree(X_train.columns, model, "../../../../static/module2/Q16")

```
```{python}
X_example = np.array([133, 101, 52, 23, 74, 12, 5]).reshape(1,7)

model.predict(X_example)
```


```{python echo=FALSE}
hockey = pd.read_csv('data/canucks.csv')

## Adjusted path 
path = "../../../../static/module2/"

hockey = hockey[(hockey['Position'] != 'Goalie') ]
hockey
```

```{python}

xmin = hockey['Experience'].min()
xmax = hockey['Experience'].max()
ymin = hockey['Weight'].min()
ymax = hockey['Weight'].max()
model = DecisionTreeClassifier(max_depth=3)
model.fit(hockey.loc[:,['Experience','Weight']], hockey['Position'])
plt.figure(figsize=(4, 4))
plot_classifier(hockey.loc[:,['Experience','Weight']].to_numpy(), hockey['Position'].to_numpy(), model, lims=(0,15,160,230), ticks=True)
plt.ylabel("Player's Weight", fontsize=15)
plt.xlabel("Player's Experience", fontsize=15)
plt.xticks(fontsize= 12)
plt.yticks(fontsize= 12)
plt.savefig('hockey_q.png')
```

```{python}
hockey['Experience'].min()
hockey['Experience'].max()
hockey['Weight'].min()
hockey['Weight'].max()
```

```{python}
from matplotlib import pyplot as plt


```


```{python}

display_tree(hockey.loc[:,['Experience','Weight']].columns, model, "../../../../static/module2/module_hockey2")

```

```{python}
X= pk.drop(columns = ['deck_no', 'name', 'type', 'legendary', 'total_bs'])
y = pk['legendary']
model = DecisionTreeClassifier(max_depth=4)
model.fit(X,y)
display_tree(X.columns, model, "../../../../static/module2/pokemon")

```

```{python}
X_example = np.array([101, 59, 64, 23, 45, 76, 5]).reshape(1,7)

model.predict(X_example)
```

```{python}
pokemon_ob = pd.DataFrame(X_example, columns = X.columns)
pokemon_ob
```


```{python}
df = pd.read_csv("data/canada_usa_cities.csv")
X = df.drop(["country"], axis=1)
y = df["country"]
depth=1
model = DecisionTreeClassifier(max_depth=depth)
model.fit(X,y)
plt.figure(figsize=(4, 4))
plot_classifier(X.to_numpy(), y.to_numpy(), model)
plt.title("Decision tree with depth = %d" % (depth))
```
```{python}
pk
```

```{python}
pk = pd.read_csv('data/pokemon.csv').dropna()
pk
## Adjusted path 
path = "../../../../static/module4/"

X= pk.drop(columns = ['Unnamed: 0', 'song_title', 'song_title','artist', 'target'])
y = pk['target']
X
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=7)
```


```{python}
bball = pd.read_csv('bball.csv')

## Adjusted path 
path = "../../../../static/module4/"

bball['height']= bball['height']*100
bball['weight']= (bball['weight']*2.20462).round(2)
bball = bball[(bball['position'] == 'F') | (bball['position'] == 'G') ]
bball
```


```{python}


```

```{python}

from sklearn.neighbors import KNeighborsClassifier
results_dict = {"n_neighbors": [], "mean_train_score": [], "mean_cv_score": []}


for K in range(1,30):
    knn100 = KNeighborsClassifier(n_neighbors=K)
    scores = cross_validate(knn100, X_train, y_train.to_numpy(),cv=10, return_train_score = True)
    results_dict["n_neighbors"].append(K)
    results_dict["mean_cv_score"].append(np.mean(scores["test_score"]))
    results_dict["mean_train_score"].append(np.mean(scores["train_score"]))

```


```{python}
bball = pd.read_csv('bball.csv')
bball = bball[(bball['position'] == 'F') | (bball['position'] == 'G') ]
bball
```



```{python  fig.width = 12, fig.height = 7,  out.width = '70%', fig.align='center'}

bball = pd.read_csv('bball.csv')
#bball = bball[(bball['position'] == 'F') | (bball['position'] == 'G') ]
bball = bball[(bball['draft_year'] != 'Undrafted') & (bball['draft_round'] != 'Undrafted') & (bball['draft_peak'] != 'Undrafted')]

train_df, test_df = train_test_split(bball, test_size=0.2, random_state=42)

X_train = train_df.drop(columns=['full_name', 'jersey', 'b_day', 'college'])
y_train = train_df['position']

X_test = test_df.drop(columns=['full_name', 'jersey', 'b_day', 'college'])
y_test = test_df['position']

numeric_features = [
    "rating",
    "height",
    "weight",
    "salary",
    "draft_year",
    "draft_round",
    "draft_peak"
]

categorical_features = [
    "team",
    "country"
]

numeric_transformer = make_pipeline(SimpleImputer(strategy="median"), StandardScaler())

categorical_transformer = make_pipeline(
    SimpleImputer(strategy="most_frequent"),
    OneHotEncoder(handle_unknown="ignore"),
)

preprocessor = make_column_transformer(
    (numeric_transformer, numeric_features), 
    (categorical_transformer, categorical_features)
)

pipe = make_pipeline(preprocessor, SVC())
pipe.fit(X_train, y_train);

plot_confusion_matrix(pipe, X_test, y_test, values_format="d", cmap="Blues", labels = ['F', 'C', 'G', 'G-F', 'F-C', 'F-G']);
plt.show()
```
```{python}
from sklearn.metrics import classification_report


y_test.unique()

```



```{python}
source = results_df.melt(id_vars=['n_neighbors'] , 
                              value_vars=['mean_train_score', 'mean_cv_score'], 
                              var_name='plot', value_name='score')
source
```


```{python}
chart1 = alt.Chart(source).mark_line().encode(
    alt.X('n_neighbors:Q', axis=alt.Axis(title="n_neighbors")),
    alt.Y('score:Q', scale=alt.Scale(domain=[.82, 1.00])),
    alt.Color('plot:N', scale=alt.Scale(domain=['mean_train_score', 'mean_cv_score'],
                                           range=['teal', 'gold'])))
chart1
```

```{python include =FALSE}
chart1.save(path + 'Q18a.png')
```


```{python}
bball = pd.read_csv('data/basketball.csv')
bball['height'].str.split('/ ', expand=True)[[0]]
bball['weight'].str.split('/ ', expand=True)[0].str.strip(' lbs.')
bball['height'] = bball['height'].str.split('/ ', expand=True)[[1]].astype('float')
bball['weight'] = bball['weight'].str.split('/ ', expand=True)[1].str.strip(' kg.').astype('float')
bball['salary'] = bball['salary'].str.strip('$').astype('float')
bball.to_csv('bball.csv', index=False)
bball
```


```{python}
bball['position'].value_counts() 
```


```{python}
# Loading in the data
pokemon_df = pd.read_csv('data/pokemon.csv')

# Define X and y
X = pokemon_df.drop(columns = ['deck_no', 'name','total_bs', 'type', 'legendary'])
y = pokemon_df['legendary']

# Split the dataset
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=33)

results_dict = {"n_neighbors": [], "mean_train_score": [], "mean_cv_score": []}

# Create a for loop and fill in the blanks
for k in range(1,50):
    model = NearestNeighbors(n_neighbors=k)
    scores = cross_validate(model, X_train, y_train, return_train_score=True)
    results_dict["n_neighbors"].append(k)
    results_dict["mean_cv_score"].append(scores["test_score"].mean())
    results_dict["mean_train_score"].append(scores["train_score"].mean())

# Wrangles the data into a form suitable for plotting 
results_df = pd.DataFrame(results_dict).melt(id_vars=['n_neighbors'],
                                             value_vars=['mean_train_score',
                                                         'mean_cv_score'], 
                                             var_name='split',
                                             value_name='score')

# Create a chart that plots depth vs score
chart1 = alt.Chart(results_df).mark_line().encode(
         alt.X('n_neighbors:Q', axis=alt.Axis(title="Number of Neighbours")),
         alt.Y('score:Q', scale=alt.Scale(domain=[.80, 1.00])), 
         alt.Color('split:N', scale=alt.Scale(domain=['mean_train_score',
                                                     'mean_cv_score'],
                                             range=['teal', 'gold'])))
chart1
```

```{python}
cities_df = pd.read_csv("data/canada_usa_cities.csv")
train_df, test_df = train_test_split(cities_df, test_size=0.4, random_state=77)
train_df.head()
X_train, y_train = train_df.drop(columns=['country']), train_df['country']
X_test, y_test = test_df.drop(columns=['country']), test_df['country']
```
```{python}
pk
```

```{python}
pk = pk.sample(100)
X= pk[['attack', 'defense']]
y = pk['legendary']
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=77)
```


```{python }
knn = KNeighborsClassifier(n_neighbors=3)
knn.fit(X_train, y_train)
scores = cross_validate(knn, X_train, y_train, return_train_score=True)
pd.DataFrame(scores)
```

```{python}
svm = SVC(gamma=0.001, C=100)
svm.fit(X_train, y_train)
scores = cross_validate(svm, X_train, y_train, return_train_score=True)
pd.DataFrame(scores)
```

```{python echo=FALSE}
plt.figure(figsize=(16, 8))
plt.subplot(1, 2, 1)
#plt.title("")
plot_classifier(X_train, y_train, knn, ax=plt.gca())
plt.subplot(1, 2, 2)
plt.title("")
plot_classifier(X_train, y_train, svm, ax=plt.gca())

```



```{python}
nb_file = tempfile(fileext = '.ipynb')
jsonlite::write_json(nb_data, nb_file, auto_unbox = TRUE, pretty = TRUE)
xfun::file_string(nb_file)  # show file content

# convert to R Markdown
nb_rmd = rmarkdown:::convert_ipynb(nb_file)
```

```{python}
u = np.array([5, 0, 22, -11])
v = np.array([-1, 0, 19, -9])
w = np.array([0, 1, 17, -4])
```

```{python}
import numpy as np
from sklearn.metrics.pairwise import euclidean_distances
euclidean_distances([v,w])
```
```{python}
data = [[ 'apple', 'red', 'canada', True, 'round', True, 84, 100],
        ['banana', 'yellow', 'mexico', False, 'long', True, 75, 120],
        ['cantaloupe', 'orange', 'spain', True, 'round', True, 90, 1360],
        ['dragon-fruit', 'magenta', 'china', True, 'round', False, 96, 600],
        ['elderberry', 'purple', 'austria', False, 'round', True, 80, 5],
        ['fig', 'purple', 'turkey', False, 'oval', False, 78, 40],
        ['guava', 'green', 'mexico', True, 'oval', True, 83, 450],
        ['huckleberry', 'blue', 'canada', True, 'round', True, 73, 5],
        ['kiwi', 'brown', 'china', True, 'round', True, 80, 76],
        ['lemon', 'yellow', 'mexico', False, 'oval', False, 83, 65],
       ] 
  
# Create the pandas DataFrame 
fruit_salad = pd.DataFrame(data, columns = ['name', 'colour', 'location', 'seed', 'shape', 'sweetness', 'water_content', 'weight' ]) 
fruit_salad
```

```{python}
from sklearn.preprocessing import OneHotEncoder

ohe = OneHotEncoder(sparse=False, dtype='int')
ohe.fit(fruit_salad[['shape']]);
X_toy_ohe = ohe.transform(fruit_salad[['shape']])

X_toy_ohe.T
```
```{python}
from sklearn.preprocessing import OrdinalEncoder

oe = OrdinalEncoder(dtype=int)
oe.fit(X_toy);
X_toy_ord = oe.transform(X_toy)

X_toy_ord
```


```{python}
pd.DataFrame(
    data=X_toy_ohe,
    columns=ohe.get_feature_names(['shape']),
    index=fruit_salad.index,
)
```


```{python}
data = [[ 'apple', 'red',False, 'canada', 6, True, 'round', True, 84, 100],
        ['banana', 'yellow', True, 'mexico',12, False, 'long', True, 75, 120],
        ['cantaloupe', 'orange', False, 'spain',8, True, 'round', True, 90, 1360],
        ['dragon-fruit', 'magenta', False, 'china',18, True, 'round', False, 96, 600],
        ['elderberry', 'purple',False, 'austria',11, False, 'round', True, 80, 5],
        ['fig', 'purple', False,  'turkey',8, False, 'oval', False, 78, 40],
        ['guava', 'green', True, 'mexico',14, True, 'oval', True, 83, 450],
        ['huckleberry', 'blue', False,  'canada',6, True, 'round', True, 73, 5],
        ['kiwi', 'brown', True, 'china',8, True, 'round', True, 80, 76],
        ['lemon', 'yellow', True, 'mexico',4, False, 'oval', False, 83, 65],
       ] 
  
# Create the pandas DataFrame 
fruit_salad = pd.DataFrame(data, columns = ['name', 'colour','tropical', 'location','carbs', 'seed', 'shape', 'sweetness', 'water_content', 'weight' ]) 
fruit_salad
```

```{python}
fruit_salad.drop(columns = ['name'])

numeric_features = ['water_content', 'weight', 'carbs']

categorical_features = ['colour', 'location', 'seed', 'shape', 'sweetness', 'tropical']
```

```{python}
numeric_transformer = make_pipeline(SimpleImputer(strategy="median"), StandardScaler())

categorical_transformer = make_pipeline(
    SimpleImputer(strategy="constant", fill_value="missing"),
    OneHotEncoder(handle_unknown="ignore"),
)

preprocessor = make_column_transformer(
    (numeric_transformer, numeric_features), 
    (categorical_transformer, categorical_features)
)

pipe = make_pipeline(preprocessor, DecisionTreeClassifier())

preprocessor
```

```{python}
from sklearn import set_config
set_config(display='diagram')
pipe
```

```{python}
X = [ "Take me to the river",
    "Drop me in the water.",
    "Push me in the river,",
    " dip me in the water"]

```


```{python}
from sklearn.feature_extraction.text import CountVectorizer
```

```{python}
vec = CountVectorizer()
X_counts = vec.fit_transform(X);
bow_df = pd.DataFrame(X_counts.toarray(), columns=sorted(vec.vocabulary_), index=X)
bow_df
```


```{python}
len(vec.vocabulary_)
```

```{python}
vec8_binary = CountVectorizer(binary=True, max_features=5)
X_counts_binary = vec8_binary.fit_transform(X)
pd.DataFrame(data = X_counts_binary.sum(axis=0).tolist()[0], 
             index = vec8_binary.get_feature_names(), columns=['counts']).sort_values('counts', ascending=False)
X_counts_binary.toarray()
```

